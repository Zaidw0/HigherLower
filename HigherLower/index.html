<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Higher or Lower - YouTube API</title>
<link rel="icon" type="image/png" href="vista.png">


<style>
    body {
        margin: 0;
        background: #eaeaea;
        font-family: Roboto, Arial, sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .topbar {
        width: 100%;
        height: 56px;
        background: white;
        display: flex;
        align-items: center;
        padding: 0 20px;
        box-sizing: border-box;
        box-shadow: 0 1px 2px rgba(0,0,0,0.15);
        position: sticky;
        top: 0;
    }

    .youtube-logo {
        height: 26px;
    }

    .score-box {
        margin-top: 15px;
        background: white;
        padding: 10px 22px;
        border-radius: 14px;
        font-size: 15px;
        font-weight: 600;
        box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }

    .container {
        display: flex;
        gap: 40px;
        margin-top: 20px;
    }

    .video-card {
        width: 550px;
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.12);
        overflow: hidden;
        transition: transform 0.15s ease;
    }

    .video-card:hover {
        transform: translateY(-4px);
    }

    .thumb-container {
        position: relative;
        width: 100%;
        height: 300px;
        overflow: hidden;
        background: #ddd;
        cursor: pointer;
    }

    .thumb-container img,
    .thumb-container iframe {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .channel-info {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 12px 16px 0;
    }

    .channel-info img {
        width: 40px;
        height: 40px;
        border-radius: 50%;
    }

    .title {
        font-size: 15px;
        font-weight: 500;
        color: #0f0f0f;
        line-height: 1.2em;
        max-height: 2.4em;
        overflow: hidden;
    }

    .views {
        color: #414141;
        margin: 10px 16px;
        font-size: 20px;
    }

    .buttons {
        display: flex;
        justify-content: center;
        gap: 25px;  
        margin: 20px 0 15px;
    }

    .btn {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        border: none;
        background: #3e3e3e;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;    
        transition: 0.2s;
    }

    .btn:hover {
        background: #000000;
    }

    .triangle-up {
        width: 0;
        height: 0;
        border-left: 10px solid transparent;
        border-right: 10px solid transparent;
        border-bottom: 18px solid #ffffff;
    }

    .triangle-down {
        width: 0;
        height: 0;
        border-left: 10px solid transparent;
        border-right: 10px solid transparent;
        border-top: 18px solid #ffffff;
    }

    /* === MODAL === */
    .modal {
        display: none; 
        position: fixed;
        z-index: 100;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0,0,0,0.5);
        align-items: center;
        justify-content: center;
    }

    .modal-content {
        background-color: #fff;
        margin: auto;
        padding: 30px;
        border-radius: 12px;
        text-align: center;
        width: 300px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }

    .modal-content h2 {
        margin-bottom: 20px;
    }

    .modal-content button {
        background: #ff0000;
        color: white;
        border: none;
        padding: 10px 25px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        transition: 0.2s;
    }

    .modal-content button:hover {
        background: #cc0000;
    }


    #confetti-container {
    position: fixed;
    bottom: 0; /* sale desde abajo */
    left: 0;
    width: 100%;
    height: 0;
    overflow: visible;
    pointer-events: none;
    z-index: 200;
    }

   #confetti-container {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 0;
    overflow: visible;
    pointer-events: none;
    z-index: 9999;
    }

    .confetti {
        position: absolute;
        opacity: 0.95;
        will-change: transform, opacity;
    }


    

/* ------------- üì± AJUSTE TOTAL PARA CELULARES ------------- */

@media (max-width: 900px) {

    /* contenedor vertical */
    .container {
        flex-direction: column;
        gap: 20px;
        width: 100%;
        padding: 0 10px;
        box-sizing: border-box;
        align-items: center;
    }

    .video-card {
        width: 100%;
        max-width: 400px;
    }

    .thumb-container {
        height: 400px;
    }

    .title {
        font-size: 14px;
        max-height: none;
    }

    .views {
        font-size: 18px;
    }

    .buttons {
        gap: 15px;
    }

    .btn {
        width: 45px;
        height: 45px;
    }

    .triangle-up, .triangle-down {
        border-left-width: 8px;
        border-right-width: 8px;
    }

    .triangle-up {
        border-bottom-width: 14px;
    }
    .triangle-down {
        border-top-width: 14px;
    }
}

.play-overlay {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 65px;
    height: 65px;
    border-radius: 50%;
    background: rgba(0,0,0,0.55);
    display: flex;
    align-items: center;
    justify-content: center;
    pointer-events: none;
    transition: 0.2s;
}

.play-overlay .triangle {
    width: 0;
    height: 0;
    border-left: 22px solid white;
    border-top: 14px solid transparent;
    border-bottom: 14px solid transparent;
}

.thumb-container:hover .play-overlay {
    background: rgba(0,0,0,0.75);
}

/* versi√≥n m√≥vil m√°s peque√±a */
@media (max-width: 480px) {
    .play-overlay {
        width: 45px;
        height: 45px;
    }

    .play-overlay .triangle {
        border-left-width: 16px;
        border-top-width: 10px;
        border-bottom-width: 10px;
    }
}


/* EXTRA: modo muy peque√±o (tel√©fonos chicos) */
@media (max-width: 480px) {
    .thumb-container {
        height: 200px;
    }

    .video-card {
        max-width: 95%;
    }

    .score-box {
        font-size: 14px;
        padding: 8px 16px;
    }
}

</style>
</head> 
<body>

<!-- BARRA SUPERIOR -->
<div style="
    width: 97%;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 20px;
    background: #ffffff;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    font-family: Roboto, Arial, sans-serif;
">

    <!-- LOGO YOUTUBE (IZQUIERDA) -->
    <div style="display: flex; align-items: center; gap: 10px;">
        <img src="https://www.logo.wine/a/logo/YouTube/YouTube-Icon-Full-Color-Logo.wine.svg"
             alt="YouTube"
             style="height: 35px;">
        <span style="font-size: 18px; font-weight: bold;">Higher or Lower</span>
    </div>

    <!-- CREDITOS (DERECHA) -->
    <a href="https://www.youtube.com/@Zaid.q0"
       target="_blank"
       style="display:flex; align-items:center; gap:8px; text-decoration:none; color:#444;">

        <span style="font-size: 12px;">Created by</span>

        <img src="logo.jpg"
            alt="Canal"
            style="
                width: 35px;
                height: 35px;
                border-radius: 50%;
                object-fit: cover;
                box-shadow: 0 2px 8px rgba(0,0,0,0.25);
            "
        ></a>
</div>


<div id="score-container" style="
    display: flex;
    align-items: center;
    gap: 10px;
    font-family: Roboto, Arial, sans-serif;
    margin-top: 10px;
">
    <div id="score" style="
        background: white;
        padding: 8px 14px;
        border-radius: 8px;
        font-size: 20px;
        font-weight: bold;
        color: #333;
        box-shadow: 0px 2px 4px rgba(0,0,0,0.15);
    ">
        Score: 0
    </div>

    <div id="best" style="
        background: #262626bb;
        padding: 4px 10px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: bold;
        color: #ffffff;
        border: 1px solid #ddd;
    ">
        Record: 0
    </div>
</div>


<div class="container">
    <div class="video-card">
       <div class="thumb-container" onclick="playWithSound(1)">
            <img class="thumb" id="thumb1" src="">
            <div class="play-overlay" id="play1">
                <div class="triangle"></div>
            </div>
        </div>

        <div class="channel-info">
            <img id="icon1" src="">
            <span id="title1" class="title"></span>
        </div>
        <p class="views" id="views1"></p>
    </div>

    <div class="video-card">
        <div class="thumb-container" onclick="playWithSound(2)">
            <img class="thumb" id="thumb2" src="">
            <div class="play-overlay" id="play2">
                <div class="triangle"></div>
            </div>
        </div>

        <div class="channel-info">
            <img id="icon2" src="">
            <span id="title2" class="title"></span>
        </div>
        <p class="views" id="views2" style="visibility: hidden;"></p>

        <div class="buttons">
            <button class="btn" onclick="choose('higher')">
                <div class="triangle-up"></div>
            </button>
            <button class="btn" onclick="choose('lower')">
                <div class="triangle-down"></div>
            </button>
        </div>
    </div>
</div>

<!-- MODAL -->
<div id="loseModal" class="modal">
    <div class="modal-content">
        <h2>Game over</h2>
        <p id="recordText">Score: 0</p>
        <button onclick="restartGame()">Restart</button>
    </div>
</div>


<div id="confetti-container"></div>

<script>


const VIDEO_IDS = [
   "aHYvmY3nV5U", "5rjCRPG3mkw", "oM9fUlGET-w", "UaMBtjxvuMA", 
"VZzSBv6tXMw", "5qap5aO4i9A", "0e3GPea1Tyg", "zxYjTTXc-J8",
 "4SNThp0YiU4", "vcdxMNgHTrc", "2iXfRr6-vks", "L1Ta38LNcUE", 
"_u3NH5yGZt0", "npTC6b5-yvM", "GW_fdXHOWp4", "htg_e_Q8D6s", 
"OTlVmfO_j0Q", "wAMZ6KpMGQI", "5qR82rFJG7I", "b89CnP0Iq30",
"jNQXAC9IVRw", "_OBlgSz8sSM", "dhsy6epaJGs", "3bTER3G6YlI",
"vM34iKSsW0Y", "t7gIutuQQLs", "lSm4QZqN8cA", "M4LWw7Jpij8",
"F81wlI9iEpw", "EbaRo2hMEqM", "bf-B1QORoMM", "yI9Ynn6JjvM",
"6Dh-RL__uN4", "oE2rfyhIsuk", "dQw4w9WgXcQ", "2yJgwwDcgV8",
"zAG83xZhgsc", "kJQP7kiw5Fk", "uAOR6ib95kQ", "HyHNuVaZJ-k",
"XqZsoesa55w", "YeJiADXCDis", "M3oT3-4sSOY", "leEGG-o0cJQ",
"dBxOYE2j55U", "KK9bwTlAvgo", "sboXdNY4g9I", "TaQj43Lf3tw",
"bix8qWbrZ-0", "iuQoT2hUVjk", "rYyfQiTHs7w", "QdBZY2fkU-0",
"Ci_zad39Uhw"
];

let videoCache = {};
let usedIndexes = [];
let score = 0;
let record = Number(localStorage.getItem("higherlower_record")) || 0;
document.getElementById("best").innerText = "Record: " + record;


async function fetchVideoData(id) {
    const res = await fetch(`/api/youtube?id=${id}`);
    return await res.json();
}


async function getRandomVideo(excludeIndex = null) {
    let idx;

    do {
        idx = Math.floor(Math.random() * VIDEO_IDS.length);
    } while (idx === excludeIndex || usedIndexes.includes(idx));

    usedIndexes.push(idx);

    // Reiniciar lista usada si ya casi se usaron todos
    if (usedIndexes.length >= VIDEO_IDS.length - 1) usedIndexes = [];

    const videoId = VIDEO_IDS[idx];

    // ‚Üì‚Üì‚Üì Si ya est√° en cach√©, no llamamos a API
    if (videoCache[videoId]) {
        return { ...videoCache[videoId], index: idx };
    }

    // ‚Üì‚Üì‚Üì Primera vez ‚Üí llamar API y guardar en cach√©
    const data = await fetchVideoData(videoId);
    videoCache[videoId] = data;

    return { ...data, index: idx };
}


let current, next;

function render() {
    document.getElementById("thumb1").src = current.thumb;
    document.getElementById("icon1").src = current.icon;
    document.getElementById("title1").innerText = current.title;
    document.getElementById("views1").innerText = current.views.toLocaleString() + " views";

    document.getElementById("thumb2").src = next.thumb;
    document.getElementById("icon2").src = next.icon;
    document.getElementById("title2").innerText = next.title;

    document.getElementById("play1").style.display = "flex";
    document.getElementById("play2").style.display = "flex";
}

function updateScore() {
    document.getElementById("score").innerText = "Score: " + score;
}

function updateBest() {
    document.getElementById("best").innerText = "Record: " + record;
}

async function startGame() {
    score = 0;
    updateScore();
    updateBest();
    current = await getRandomVideo();
    next = await getRandomVideo(current.index);
    render();
}

function showModal() {
    document.getElementById("recordText").innerText = "Score: " + score;
    document.getElementById("loseModal").style.display = "flex";
}

function restartGame() {
    document.getElementById("loseModal").style.display = "none";

    // Ocultar vistas
    const reveal = document.getElementById("views2");
    reveal.style.visibility = "hidden";

    // Eliminar cualquier iframe activo (video reproduci√©ndose)
    [1, 2].forEach(n => {
        const container = document.getElementById("thumb" + n).parentNode;
        container.querySelectorAll("iframe").forEach(i => i.remove());
        document.getElementById("thumb" + n).style.display = "block";
    });

    document.getElementById("play1").style.display = "flex";
    document.getElementById("play2").style.display = "flex";
    startGame();
}

// Funci√≥n para animar vistas y devolver una promesa
function animateViews(start, end) {
    return new Promise((resolve) => {
        const reveal = document.getElementById("views2");
        const duration = 1000; // Duraci√≥n de la animaci√≥n en ms
        const stepTime = 20; // Tiempo entre incrementos en ms
        const steps = Math.ceil(duration / stepTime);
        let currentStep = 0;

        const increment = (end - start) / steps;

        const interval = setInterval(() => {
            currentStep++;
            const value = Math.floor(start + increment * currentStep);
            reveal.innerText = value.toLocaleString() + " views";

            if (currentStep >= steps) {
                reveal.innerText = end.toLocaleString() + " views"; 
                clearInterval(interval);
                resolve(); // Resolvemos la promesa cuando termina
            }
        }, stepTime);
    });
}

function spawnConfetti() {
    const container = document.getElementById("confetti-container");
    const total = 40; // m√°s confetti pero sin lag

    for (let i = 0; i < total; i++) {
        const confetti = document.createElement("div");
        confetti.classList.add("confetti");

        // Tama√±o m√°s natural
        const size = 6 + Math.random() * 10;
        confetti.style.width = size + "px";
        confetti.style.height = size * (0.6 + Math.random()) + "px";

        // Colores m√°s bonitos
        confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 85%, 60%)`;

        // Formas aleatorias: cuadrados, rect√°ngulos, c√≠rculos
        const r = Math.random();
        if (r < 0.33) {
            confetti.style.borderRadius = "0%";
        } else if (r < 0.66) {
            confetti.style.borderRadius = "50%";
        } else {
            confetti.style.transform = "skew(15deg)";
        }

        // Posici√≥n inicial (fondo)
        confetti.style.left = Math.random() * 100 + "vw";
        confetti.style.bottom = "0px";

        // Animaci√≥n con keyframes din√°micos
        const translateY = 250 + Math.random() * 250; // altura de ascenso
        const translateX = (Math.random() - 0.5) * 200; // movimiento lateral
        const rotate = Math.random() * 720;

        confetti.animate(
            [
                { 
                    transform: `translate(0,0) rotate(0deg)`,
                    opacity: 1 
                },
                { 
                    transform: `translate(${translateX}px, -${translateY}px) rotate(${rotate}deg)`,
                    opacity: 0 
                }
            ],
            {
                duration: 1200 + Math.random() * 300, // tiempos distintos
                easing: "cubic-bezier(0.33, 1, 0.68, 1)", // ease-out suave
                fill: "forwards"
            }
        );

        container.appendChild(confetti);

        // Eliminar despu√©s
        setTimeout(() => confetti.remove(), 2000);
    }
}


// Modificar choose() para esperar animaci√≥n
async function choose(option) {
    const reveal = document.getElementById("views2");
    reveal.style.visibility = "visible";

    const correct =
        (option === "higher" && next.views > current.views) ||
        (option === "lower" && next.views < current.views);

    // Animar vistas primero
    await animateViews(0, next.views);

    if (!correct) {
        showModal();
        return;
    }
    spawnConfetti();
    score++;
    if (score > record) {
    record = score;
    localStorage.setItem("higherlower_record", record);
    document.getElementById("best").innerText = "Record: " + record;
}
    updateBest();
    updateScore();

    // Esperar 2 segundos extra antes de renderizar siguiente par
    setTimeout(async () => {
        [1,2].forEach(n => {
            const container = document.getElementById("thumb" + n).parentNode;
            container.querySelectorAll("iframe").forEach(i => i.remove());
            document.getElementById("thumb" + n).style.display = "block";
        });

        current = next;
        next = await getRandomVideo(current.index);

        reveal.style.visibility = "hidden";

        render();
    }, 2000);
}



function playWithSound(n) {
    const img = document.getElementById("thumb" + n);
    const overlay = document.getElementById("play" + n);
    const videoId = (n === 1 ? current.videoId : next.videoId);

    img.parentNode.querySelectorAll("iframe").forEach(i => i.remove());

    const iframe = document.createElement("iframe");
    iframe.src =
        `https://www.youtube.com/embed/${videoId}?autoplay=1&controls=1&modestbranding=1&playsinline=1`;
    iframe.setAttribute("frameborder", "0");
    iframe.setAttribute("allow", "autoplay; encrypted-media");
    iframe.style.width = "100%";
    iframe.style.height = "100%";

    img.style.display = "none";
    overlay.style.display = "none";  // OCULTAR √çCONO PLAY
    img.parentNode.appendChild(iframe);
}
let savedRecord = localStorage.getItem("higherlower_record");
if (savedRecord) {
    record = Number(savedRecord);
}
startGame();
</script>
</body>
</html>



